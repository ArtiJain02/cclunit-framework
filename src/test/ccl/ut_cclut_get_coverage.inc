/**
  Unit Tests for cclut_code_coverage.inc functions
*/

%i cclsource:cclut_get_coverage.inc

declare setupOnce(null) = null
declare testRemoveCoverage(null) = null
declare testGetNextCoverage(null) = null
declare testGetCoverageName(null) = null
declare testGetLineCoverage(null) = null

declare sourceCoverage = vc with protect, noconstant("")

subroutine setupOnce(null)
%i cclsource:ut_cclut_gci.inc
end ;;;setupOnce


subroutine testRemoveCoverage(null)  
  declare coverageXml = vc with protect, noconstant("")
  declare expected = vc with protect, noconstant("")
  declare stat = i4 with protect, noconstant(0)
  
  set coverageXml = sourceCoverage
    
%i cclsource:ut_cclut_gci_1.inc
    
    set coverageXml = cclut::removeCoverage(coverageXml, "PRG_10290834_139796")
    set stat = cclutAssertVCEqual(CURREF, "xml removal", coverageXml, expected)
end ;;;testRemoveCoverage


subroutine testGetNextCoverage(null)
  declare coverageXml = vc with protect, noconstant("")
  declare nextCoverage = vc with protect, noconstant("")
  declare expected = vc with protect, noconstant("")
  declare stat = i4 with protect, noconstant(0)
  
  set coverageXml = sourceCoverage

    
  set expected = "\
<COVERAGE><COVERAGE_NAME>CCLUT_PARSE_SOURCE</COVERAGE_NAME><LINES><LINE><NBR>1</NBR><TYPE>N</TYPE></LINE><LINE><NBR>2</NBR><TYPE>N\
</TYPE></LINE><LINE><NBR>3</NBR><TYPE>N</TYPE></LINE><LINE><NBR>4</NBR><TYPE>N</TYPE></LINE><LINE><NBR>5</NBR><TYPE>N</TYPE></LINE\
><LINE><NBR>6</NBR><TYPE>N</TYPE></LINE><LINE><NBR>7</NBR><TYPE>N</TYPE></LINE><LINE><NBR>8</NBR><TYPE>N</TYPE></LINE><LINE><NBR>9\
</NBR><TYPE>N</TYPE></LINE><LINE><NBR>10</NBR><TYPE>N</TYPE></LINE><LINE><NBR>11</NBR><TYPE>N</TYPE></LINE><LINE><NBR>12</NBR><TYP\
E>N</TYPE></LINE><LINE><NBR>13</NBR><TYPE>N</TYPE></LINE><LINE><NBR>14</NBR><TYPE>N</TYPE></LINE><LINE><NBR>15</NBR><TYPE>N</TYPE>\
</LINE><LINE><NBR>16</NBR><TYPE>N</TYPE></LINE><LINE><NBR>17</NBR><TYPE>N</TYPE></LINE><LINE><NBR>18</NBR><TYPE>N</TYPE></LINE><LI\
NE><NBR>19</NBR><TYPE>N</TYPE></LINE><LINE><NBR>20</NBR><TYPE>N</TYPE></LINE><LINE><NBR>21</NBR><TYPE>N</TYPE></LINE><LINE><NBR>22\
</NBR><TYPE>N</TYPE></LINE><LINE><NBR>23</NBR><TYPE>N</TYPE></LINE><LINE><NBR>24</NBR><TYPE>N</TYPE></LINE><LINE><NBR>25</NBR><TYP\
E>N</TYPE></LINE><LINE><NBR>26</NBR><TYPE>N</TYPE></LINE><LINE><NBR>27</NBR><TYPE>N</TYPE></LINE><LINE><NBR>28</NBR><TYPE>N</TYPE>\
</LINE><LINE><NBR>29</NBR><TYPE>N</TYPE></LINE><LINE><NBR>30</NBR><TYPE>N</TYPE></LINE><LINE><NBR>31</NBR><TYPE>N</TYPE></LINE><LI\
NE><NBR>32</NBR><TYPE>N</TYPE></LINE><LINE><NBR>33</NBR><TYPE>C</TYPE></LINE><LINE><NBR>34</NBR><TYPE>C</TYPE></LINE><LINE><NBR>35\
</NBR><TYPE>C</TYPE></LINE><LINE><NBR>36</NBR><TYPE>C</TYPE></LINE><LINE><NBR>37</NBR><TYPE>C</TYPE></LINE><LINE><NBR>38</NBR><TYP\
E>C</TYPE></LINE><LINE><NBR>39</NBR><TYPE>C</TYPE></LINE><LINE><NBR>40</NBR><TYPE>C</TYPE></LINE><LINE><NBR>41</NBR><TYPE>C</TYPE>\
</LINE><LINE><NBR>42</NBR><TYPE>N</TYPE></LINE><LINE><NBR>43</NBR><TYPE>C</TYPE></LINE><LINE><NBR>44</NBR><TYPE>C</TYPE></LINE><LI\
NE><NBR>45</NBR><TYPE>N</TYPE></LINE><LINE><NBR>46</NBR><TYPE>C</TYPE></LINE><LINE><NBR>47</NBR><TYPE>C</TYPE></LINE><LINE><NBR>48\
</NBR><TYPE>C</TYPE></LINE><LINE><NBR>49</NBR><TYPE>N</TYPE></LINE><LINE><NBR>50</NBR><TYPE>C</TYPE></LINE><LINE><NBR>51</NBR><TYP\
E>N</TYPE></LINE><LINE><NBR>52</NBR><TYPE>N</TYPE></LINE><LINE><NBR>53</NBR><TYPE>N</TYPE></LINE><LINE><NBR>54</NBR><TYPE>C</TYPE>\
</LINE><LINE><NBR>55</NBR><TYPE>N</TYPE></LINE><LINE><NBR>56</NBR><TYPE>C</TYPE></LINE><LINE><NBR>57</NBR><TYPE>C</TYPE></LINE><LI\
NE><NBR>58</NBR><TYPE>N</TYPE></LINE><LINE><NBR>59</NBR><TYPE>N</TYPE></LINE><LINE><NBR>60</NBR><TYPE>C</TYPE></LINE><LINE><NBR>61\
</NBR><TYPE>N</TYPE></LINE><LINE><NBR>62</NBR><TYPE>C</TYPE></LINE><LINE><NBR>63</NBR><TYPE>N</TYPE></LINE><LINE><NBR>64</NBR><TYP\
E>N</TYPE></LINE><LINE><NBR>65</NBR><TYPE>C</TYPE></LINE><LINE><NBR>66</NBR><TYPE>N</TYPE></LINE><LINE><NBR>67</NBR><TYPE>N</TYPE>\
</LINE><LINE><NBR>68</NBR><TYPE>N</TYPE></LINE><LINE><NBR>69</NBR><TYPE>C</TYPE></LINE><LINE><NBR>70</NBR><TYPE>N</TYPE></LINE><LI\
NE><NBR>71</NBR><TYPE>C</TYPE></LINE><LINE><NBR>72</NBR><TYPE>U</TYPE></LINE><LINE><NBR>73</NBR><TYPE>N</TYPE></LINE><LINE><NBR>74\
</NBR><TYPE>N</TYPE></LINE><LINE><NBR>75</NBR><TYPE>N</TYPE></LINE><LINE><NBR>76</NBR><TYPE>C</TYPE></LINE><LINE><NBR>77</NBR><TYP\
E>C</TYPE></LINE><LINE><NBR>78</NBR><TYPE>C</TYPE></LINE><LINE><NBR>79</NBR><TYPE>N</TYPE></LINE><LINE><NBR>80</NBR><TYPE>N</TYPE>\
</LINE><LINE><NBR>81</NBR><TYPE>C</TYPE></LINE><LINE><NBR>82</NBR><TYPE>N</TYPE></LINE><LINE><NBR>83</NBR><TYPE>N</TYPE></LINE><LI\
NE><NBR>84</NBR><TYPE>C</TYPE></LINE><LINE><NBR>85</NBR><TYPE>C</TYPE></LINE><LINE><NBR>86</NBR><TYPE>C</TYPE></LINE><LINE><NBR>87\
</NBR><TYPE>N</TYPE></LINE><LINE><NBR>88</NBR><TYPE>C</TYPE></LINE><LINE><NBR>89</NBR><TYPE>C</TYPE></LINE><LINE><NBR>90</NBR><TYP\
E>C</TYPE></LINE><LINE><NBR>91</NBR><TYPE>N</TYPE></LINE><LINE><NBR>92</NBR><TYPE>N</TYPE></LINE><LINE><NBR>93</NBR><TYPE>N</TYPE>\
</LINE><LINE><NBR>94</NBR><TYPE>N</TYPE></LINE><LINE><NBR>95</NBR><TYPE>N</TYPE></LINE><LINE><NBR>96</NBR><TYPE>N</TYPE></LINE><LI\
NE><NBR>97</NBR><TYPE>N</TYPE></LINE></LINES></COVERAGE>"

    set nextCoverage = cclut::getNextCoverage(coverageXml)
    set stat = cclutAssertVcEqual(CURREF, "next coverage", nextCoverage, expected)

end ;;;testGetNextCoverage


subroutine testGetCoverageName(null) 
  declare coverageXml = vc with protect, noconstant("")
  declare coverageName = vc with protect, noconstant("")

  set coverageXml = "\
<COVERAGE><COVERAGE_NAME>CCLUT_PARSE_SOURCE</COVERAGE_NAME><LINES><LINE><NBR>1</NBR><TYPE>N</TYPE></LINE><LINE><NBR>2</NBR><TYPE>N\
</TYPE></LINE><LINE><NBR>3</NBR><TYPE>N</TYPE></LINE><LINE><NBR>4</NBR><TYPE>N</TYPE></LINE><LINE><NBR>5</NBR><TYPE>N</TYPE></LINE\
><LINE><NBR>6</NBR><TYPE>N</TYPE></LINE><LINE><NBR>7</NBR><TYPE>N</TYPE></LINE><LINE><NBR>8</NBR><TYPE>N</TYPE></LINE><LINE><NBR>9\
</NBR><TYPE>N</TYPE></LINE><LINE><NBR>10</NBR><TYPE>N</TYPE></LINE><LINE><NBR>11</NBR><TYPE>N</TYPE></LINE><LINE><NBR>12</NBR><TYP\
E>N</TYPE></LINE><COVERAGE>"

  set coverageName = cclut::getCoverageName(coverageXml)
  call cclutAssertVcEqual(CURREF, "coverage name", coverageName, "CCLUT_PARSE_SOURCE")
end ;;;testGetCoverageName

subroutine testGetLineCoverage(null)
  declare coverageXml = vc with protect, noconstant("")
  declare lineCoverage = vc with protect, noconstant("")
  declare expected = vc with protect, noconstant("")
  declare stat = i4 with protect, noconstant(0)

  set expected = "\
<LINE_COVERAGE><COVERAGE_NAME>CCLUT_PARSE_SOURCE</COVERAGE_NAME><LINE>33</LINE><LINE>34</LINE><LINE>35</LINE><LINE>36<\
/LINE><LINE>37</LINE><LINE>38</LINE><LINE>39</LINE><LINE>40</LINE><LINE>41</LINE><LINE>43</LINE><LINE>44</LINE><LINE>46</LINE\
><LINE>47</LINE><LINE>48</LINE><LINE>50</LINE><LINE>54</LINE><LINE>56</LINE><LINE>57</LINE><LINE>60</LINE><LINE>62</LINE><LIN\
E>65</LINE><LINE>69</LINE><LINE>71</LINE><LINE>76</LINE><LINE>77</LINE><LINE>78</LINE><LINE>81</LINE><LINE>84</LINE><LINE>85<\
/LINE><LINE>86</LINE><LINE>88</LINE><LINE>89</LINE><LINE>90</LINE></LINE_COVERAGE>"
  
  set coverageXml = sourceCoverage
  set coverageXml = cclut::getNextCoverage(coverageXml)
  set lineCoverage = cclut::getLineCoverage(coverageXml)
  set stat = cclutAssertVcEqual(CURREF, "line coverage", lineCoverage, expected)
  
 
  set expected = "\
<LINE_COVERAGE><COVERAGE_NAME>CCLUT_PARSE_SOURCE</COVERAGE_NAME><LINE>33</LINE><LINE>34</LINE><LINE>35</LINE><LINE>36<\
/LINE><LINE>37</LINE><LINE>38</LINE><LINE>39</LINE><LINE>40</LINE><LINE>41</LINE><LINE>43</LINE><LINE>44</LINE><LINE>46</LINE\
><LINE>47</LINE><LINE>48</LINE><LINE>50</LINE><LINE>54</LINE><LINE>56</LINE><LINE>57</LINE><LINE>60</LINE><LINE>62</LINE><LIN\
E>65</LINE><LINE>69</LINE><LINE>71</LINE><LINE>76</LINE><LINE>77</LINE><LINE>78</LINE><LINE>81</LINE><LINE>84</LINE><LINE>85<\
/LINE><LINE>86</LINE><LINE>88</LINE><LINE>89</LINE><LINE>90</LINE></LINE_COVERAGE><LINE_COVERAGE><COVERAGE_NAME>CCLUT_FIND_UNIT\
_TESTS</COVERAGE_NAME><LINE>16</LINE><LINE>30</LINE><LINE>40</LINE><LINE>42</LINE><LINE>43</LINE><LINE>45</LINE><LINE>\
46</LINE><LINE>47</LINE><LINE>48</LINE><LINE>49</LINE><LINE>50</LINE><LINE>51</LINE><LINE>53</LINE><LINE>55</LINE><LINE>56</L\
INE><LINE>57</LINE><LINE>58</LINE><LINE>61</LINE><LINE>62</LINE><LINE>63</LINE><LINE>65</LINE><LINE>67</LINE><LINE>69</LINE><\
LINE>73</LINE><LINE>74</LINE><LINE>76</LINE><LINE>85</LINE><LINE>87</LINE><LINE>88</LINE><LINE>98</LINE><LINE>111</LINE><LINE\
>112</LINE><LINE>114</LINE><LINE>115</LINE><LINE>117</LINE><LINE>118</LINE><LINE>120</LINE><LINE>121</LINE><LINE>123</LINE><L\
INE>124</LINE><LINE>126</LINE><LINE>127</LINE><LINE>129</LINE><LINE>130</LINE><LINE>132</LINE><LINE>133</LINE><LINE>135</LINE\
><LINE>136</LINE><LINE>138</LINE><LINE>139</LINE><LINE>141</LINE><LINE>142</LINE><LINE>144</LINE><LINE>145</LINE><LINE>147</L\
INE><LINE>148</LINE><LINE>150</LINE><LINE>151</LINE><LINE>153</LINE><LINE>154</LINE><LINE>156</LINE><LINE>157</LINE><LINE>159\
</LINE><LINE>160</LINE><LINE>162</LINE><LINE>163</LINE><LINE>166</LINE><LINE>167</LINE><LINE>168</LINE><LINE>169</LINE><LINE>\
170</LINE><LINE>171</LINE><LINE>172</LINE><LINE>173</LINE><LINE>174</LINE><LINE>178</LINE><LINE>179</LINE><LINE>180</LINE><LI\
NE>181</LINE><LINE>182</LINE><LINE>183</LINE><LINE>184</LINE><LINE>185</LINE><LINE>186</LINE><LINE>200</LINE><LINE>201</LINE>\
<LINE>202</LINE><LINE>206</LINE><LINE>207</LINE><LINE>211</LINE><LINE>222</LINE><LINE>223</LINE><LINE>266</LINE><LINE>267</LI\
NE><LINE>268</LINE><LINE>269</LINE><LINE>270</LINE><LINE>271</LINE><LINE>272</LINE><LINE>273</LINE><LINE>275</LINE><LINE>370<\
/LINE><LINE>371</LINE><LINE>372</LINE><LINE>373</LINE><LINE>374</LINE><LINE>375</LINE><LINE>377</LINE><LINE>379</LINE><LINE>3\
80</LINE><LINE>381</LINE><LINE>385</LINE><LINE>386</LINE><LINE>387</LINE><LINE>388</LINE><LINE>393</LINE><LINE>498</LINE><LIN\
E>533</LINE><LINE>534</LINE><LINE>535</LINE><LINE>536</LINE><LINE>537</LINE><LINE>538</LINE><LINE>539</LINE><LINE>540</LINE><\
LINE>541</LINE><LINE>542</LINE><LINE>543</LINE><LINE>544</LINE><LINE>545</LINE><LINE>546</LINE><LINE>547</LINE><LINE>549</LIN\
E><LINE>551</LINE><LINE>553</LINE><LINE>562</LINE><LINE>564</LINE><LINE>566</LINE><LINE>575</LINE><LINE>576</LINE><LINE>578</\
LINE><LINE>579</LINE><LINE>580</LINE><LINE>581</LINE><LINE>582</LINE><LINE>583</LINE><LINE>584</LINE><LINE>585</LINE><LINE>58\
6</LINE><LINE>588</LINE><LINE>589</LINE><LINE>590</LINE><LINE>591</LINE><LINE>595</LINE><LINE>596</LINE><LINE>597</LINE><LINE\
>598</LINE><LINE>600</LINE><LINE>601</LINE><LINE>604</LINE><LINE>605</LINE><LINE>607</LINE><LINE>608</LINE><LINE>612</LINE><L\
INE>614</LINE></LINE_COVERAGE>"

  set coverageXml = sourceCoverage
  set coverageXml = cclut::removeCoverage(coverageXml, "PRG_10290834_139796")
  set lineCoverage = cclut::getLineCoverage(coverageXml)
  set stat = cclutAssertVcEqual(CURREF, "line coverage", lineCoverage, expected)
end